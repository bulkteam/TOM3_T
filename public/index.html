<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TOM3 - Vorgangssteuerung</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/monitoring.css">
    <link rel="stylesheet" href="css/import-wizard.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- Navigation -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <h1>TOM3</h1>
                <p class="subtitle">Vorgangssteuerung</p>
            </div>
            <div id="user-info" class="user-info" style="display: none;">
                <div class="user-name" id="user-name">-</div>
                <div class="user-email" id="user-email">-</div>
                <div class="user-roles" id="user-roles"></div>
                <a href="logout.php" class="logout-link">Abmelden</a>
            </div>
            <ul class="nav-menu">
                <!-- Dashboard -->
                <li class="nav-menu-item">
                    <a href="#" class="nav-link nav-parent" data-menu="dashboard">
                        <span class="icon">üìä</span> Dashboard
                        <span class="nav-arrow">‚ñæ</span>
                    </a>
                    <ul class="nav-submenu">
                        <li><a href="#accounts" class="nav-link nav-child" data-page="accounts">
                            <span class="icon">üë•</span> Meine Kunden
                        </a></li>
                    </ul>
                </li>
                
                <!-- Prozesse -->
                <li class="nav-menu-item">
                    <a href="#" class="nav-link nav-parent" data-menu="prozesse">
                        <span class="icon">‚öôÔ∏è</span> Prozesse
                        <span class="nav-arrow">‚ñæ</span>
                    </a>
                    <ul class="nav-submenu">
                        <li><a href="#cases" class="nav-link nav-child" data-page="cases">
                            <span class="icon">üìã</span> Vorg√§nge
                        </a></li>
                        <li><a href="#projects" class="nav-link nav-child" data-page="projects">
                            <span class="icon">üìÅ</span> Projekte
                        </a></li>
                    </ul>
                </li>
                
                <!-- Stammdaten -->
                <li class="nav-menu-item">
                    <a href="#" class="nav-link nav-parent" data-menu="stammdaten">
                        <span class="icon">üìö</span> Stammdaten
                        <span class="nav-arrow">‚ñæ</span>
                    </a>
                    <ul class="nav-submenu">
                        <li><a href="#orgs" class="nav-link nav-child" data-page="orgs">
                            <span class="icon">üè¢</span> Organisationen
                        </a></li>
                        <li><a href="#persons" class="nav-link nav-child" data-page="persons">
                            <span class="icon">üë§</span> Personen
                        </a></li>
                    </ul>
                </li>
                
                <!-- Service -->
                <li class="nav-menu-item">
                    <a href="#" class="nav-link nav-parent" data-menu="service">
                        <span class="icon">üîß</span> Service
                        <span class="nav-arrow">‚ñæ</span>
                    </a>
                    <ul class="nav-submenu">
                        <li><a href="#import" class="nav-link nav-child" data-page="import">
                            <span class="icon">üì•</span> Import
                        </a></li>
                        <li><a href="#documents" class="nav-link nav-child" data-page="documents">
                            <span class="icon">üìÑ</span> Dokumente
                        </a></li>
                    </ul>
                </li>
                
                <!-- Admin -->
                <li class="nav-menu-item" id="admin-menu-item" style="display: none;">
                    <a href="#" class="nav-link nav-parent" data-menu="admin">
                        <span class="icon">‚öôÔ∏è</span> Admin
                        <span class="nav-arrow">‚ñæ</span>
                    </a>
                    <ul class="nav-submenu">
                        <li><a href="#monitoring" class="nav-link nav-child" data-page="monitoring">
                            <span class="icon">üîç</span> Monitoring
                        </a></li>
                    </ul>
                </li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard -->
            <div id="page-dashboard" class="page active">
                <div class="page-header">
                    <h2>Dashboard</h2>
                </div>
                <div class="dashboard-grid">
                    <div class="stat-card">
                        <div class="stat-icon">üìã</div>
                        <div class="stat-content">
                            <div class="stat-value" id="stat-cases-total">-</div>
                            <div class="stat-label">Vorg√§nge gesamt</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üîÑ</div>
                        <div class="stat-content">
                            <div class="stat-value" id="stat-cases-active">-</div>
                            <div class="stat-label">In Bearbeitung</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚è∏Ô∏è</div>
                        <div class="stat-content">
                            <div class="stat-value" id="stat-cases-waiting">-</div>
                            <div class="stat-label">Wartend</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üìÅ</div>
                        <div class="stat-content">
                            <div class="stat-value" id="stat-projects">-</div>
                            <div class="stat-label">Projekte</div>
                        </div>
                    </div>
                </div>
                <div class="dashboard-section">
                    <h3>Aktuelle Vorg√§nge</h3>
                    <div id="dashboard-recent-cases" class="case-list"></div>
                </div>
            </div>

            <!-- Cases Page -->
            <div id="page-cases" class="page">
                <div class="page-header">
                    <h2>Vorg√§nge</h2>
                    <button class="btn btn-primary" id="btn-create-case">+ Neuer Vorgang</button>
                </div>
                <div class="filters">
                    <select id="filter-status" class="filter-select">
                        <option value="">Alle Status</option>
                        <option value="neu">Neu</option>
                        <option value="in_bearbeitung">In Bearbeitung</option>
                        <option value="wartend_intern">Wartend (intern)</option>
                        <option value="wartend_extern">Wartend (extern)</option>
                        <option value="blockiert">Blockiert</option>
                        <option value="eskaliert">Eskaliert</option>
                        <option value="abgeschlossen">Abgeschlossen</option>
                    </select>
                    <select id="filter-engine" class="filter-select">
                        <option value="">Alle Engines</option>
                        <option value="customer_inbound">Customer Inbound</option>
                        <option value="ops">OPS</option>
                        <option value="inside_sales">Inside Sales</option>
                        <option value="outside_sales">Outside Sales</option>
                        <option value="order_admin">Order Admin</option>
                    </select>
                    <input type="text" id="filter-search" class="filter-input" placeholder="Suche...">
                </div>
                <div id="cases-list" class="case-list"></div>
            </div>

            <!-- Case Detail Modal -->
            <div id="modal-case-detail" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 id="modal-case-title">Vorgang Details</h3>
                        <button class="modal-close">&times;</button>
                    </div>
                    <div class="modal-body" id="modal-case-body">
                        <!-- Wird dynamisch gef√ºllt -->
                    </div>
                </div>
            </div>

            <!-- Org Detail Modal (Stammdatenblatt) -->
            <div id="modal-org-detail" class="modal">
                <div class="modal-content modal-large">
                    <div class="modal-header">
                        <h3 id="modal-org-title">Organisation Details</h3>
                        <button class="modal-close">&times;</button>
                    </div>
                    <div class="modal-body" id="modal-org-body">
                        <!-- Wird dynamisch gef√ºllt -->
                    </div>
                </div>
            </div>

            <!-- Person Detail Modal (Stammdatenblatt) -->
            <div id="modal-person-detail" class="modal">
                <div class="modal-content modal-large">
                    <div class="modal-header">
                        <h3 id="modal-person-title">Person Details</h3>
                        <button class="modal-close">&times;</button>
                    </div>
                    <div class="modal-body" id="modal-person-body">
                        <!-- Wird dynamisch gef√ºllt -->
                    </div>
                </div>
            </div>

            <!-- Create/Edit Person Modal -->
            <div id="modal-create-person" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 id="modal-create-person-title">Neue Person</h3>
                        <button class="modal-close">&times;</button>
                    </div>
                    <div class="modal-body" id="modal-create-person-body">
                        <!-- Wird dynamisch gef√ºllt -->
                    </div>
                </div>
            </div>

            <div id="modal-edit-person" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 id="modal-edit-person-title">Person bearbeiten</h3>
                        <button class="modal-close">&times;</button>
                    </div>
                    <div class="modal-body" id="modal-edit-person-body">
                        <!-- Wird dynamisch gef√ºllt -->
                    </div>
                </div>
            </div>

            <!-- Add/Edit Relation Modal -->
            <div id="modal-relation" class="modal">
                <div class="modal-content modal-large">
                    <div class="modal-header">
                        <h3 id="modal-relation-title">Relation hinzuf√ºgen</h3>
                        <button class="modal-close">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="form-relation">
                            <input type="hidden" id="relation-uuid" name="relation_uuid">
                            <input type="hidden" id="relation-parent-org-uuid" name="parent_org_uuid">
                            
                            <div class="form-group">
                                <label for="relation-type">Relationstyp <span class="required">*</span></label>
                                <select id="relation-type" name="relation_type" required>
                                    <option value="">-- Bitte w√§hlen --</option>
                                    <optgroup label="Konzern & Struktur">
                                        <option value="parent_of">Muttergesellschaft von</option>
                                        <option value="subsidiary_of">Tochtergesellschaft von</option>
                                        <option value="sister_company">Schwestergesellschaft</option>
                                        <option value="holding_of">Holding von</option>
                                        <option value="operating_company_of">Operative Gesellschaft von</option>
                                        <option value="branch_of">Niederlassung von</option>
                                        <option value="location_of">Standort von</option>
                                        <option value="division_of">Zweigstelle von</option>
                                    </optgroup>
                                    <optgroup label="Beteiligungen">
                                        <option value="owns_stake_in">Beteiligung an</option>
                                        <option value="joint_venture_with">Joint Venture mit</option>
                                        <option value="ubo_of">Ultimate Beneficial Owner von</option>
                                    </optgroup>
                                    <optgroup label="Transaktionen">
                                        <option value="acquired_from">√úbernommen von</option>
                                        <option value="merged_with">Fusioniert mit</option>
                                        <option value="spun_off_from">Abgespalten von</option>
                                        <option value="legal_successor_of">Rechtsnachfolger von</option>
                                        <option value="in_liquidation_by">In Liquidation durch</option>
                                    </optgroup>
                                    <optgroup label="Gesch√§ftliche Beziehungen">
                                        <option value="customer_of">Kunde von</option>
                                        <option value="supplier_of">Lieferant von</option>
                                        <option value="distributor_of">Distributor von</option>
                                        <option value="reseller_of">Reseller von</option>
                                        <option value="partner_of">Partner von</option>
                                        <option value="service_provider_of">Service Provider von</option>
                                        <option value="logistics_partner_of">Logistikpartner von</option>
                                        <option value="franchise_giver_of">Franchisegeber von</option>
                                        <option value="franchise_taker_of">Franchisenehmer von</option>
                                        <option value="contract_partner_of">Vertragspartner von</option>
                                        <option value="framework_contract_for">Rahmenvertrag f√ºr</option>
                                        <option value="implementation_partner_for">Implementierungspartner f√ºr</option>
                                    </optgroup>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="relation-child-org">Ziel-Organisation <span class="required">*</span></label>
                                <input type="text" id="relation-child-org-search" class="org-search-input" 
                                       placeholder="Organisation suchen..." autocomplete="off">
                                <input type="hidden" id="relation-child-org-uuid" name="child_org_uuid" required>
                                <div id="relation-child-org-results" class="org-search-results" style="display: none;"></div>
                                <small class="form-hint">Geben Sie den Namen der Organisation ein</small>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="relation-since-date">Seit (Datum)</label>
                                    <input type="date" id="relation-since-date" name="since_date">
                                </div>

                                <div class="form-group">
                                    <label for="relation-until-date">Bis (Datum)</label>
                                    <input type="date" id="relation-until-date" name="until_date">
                                    <small class="form-hint">Leer lassen f√ºr aktuelle Relation</small>
                                </div>
                            </div>

                            <div id="relation-ownership-fields" style="display: none;">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="relation-ownership-percent">Beteiligungsanteil (%)</label>
                                        <input type="number" id="relation-ownership-percent" name="ownership_percent" 
                                               min="0" max="100" step="0.01" placeholder="z.B. 51.5">
                                    </div>

                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox" id="relation-has-voting-rights" name="has_voting_rights" value="1">
                                            Stimmberechtigt
                                        </label>
                                        <br>
                                        <label>
                                            <input type="checkbox" id="relation-is-direct" name="is_direct" value="1" checked>
                                            Direkt (nicht indirekt)
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="relation-confidence">Vertrauensw√ºrdigkeit</label>
                                    <select id="relation-confidence" name="confidence">
                                        <option value="high">Hoch</option>
                                        <option value="medium">Mittel</option>
                                        <option value="low">Niedrig</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label>
                                        <input type="checkbox" id="relation-is-current" name="is_current" value="1" checked>
                                        Aktuell g√ºltig
                                    </label>
                                    <small class="form-hint">Deaktivieren f√ºr historische Relationen</small>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="relation-tags">Tags</label>
                                <input type="text" id="relation-tags" name="tags" 
                                       placeholder="z.B. Konzernstruktur, Go-to-Market (kommagetrennt)">
                                <small class="form-hint">Mehrere Tags durch Komma trennen</small>
                            </div>

                            <div class="form-group">
                                <label for="relation-source">Quelle/Beleg</label>
                                <input type="text" id="relation-source" name="source" 
                                       placeholder="Link, Datei, Referenz...">
                            </div>

                            <div class="form-group">
                                <label for="relation-notes">Notizen</label>
                                <textarea id="relation-notes" name="notes" rows="3" 
                                          placeholder="Zus√§tzliche Informationen..."></textarea>
                            </div>

                            <div class="form-actions">
                                <button type="submit" class="btn btn-success" id="btn-submit-relation">Speichern</button>
                                <button type="button" class="btn btn-secondary" id="btn-cancel-relation">Abbrechen</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Add/Edit Address Modal -->
            <div id="modal-address" class="modal">
                <div class="modal-content modal-large">
                    <div class="modal-header">
                        <h3 id="modal-address-title">Adresse hinzuf√ºgen</h3>
                        <button class="modal-close">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="form-address">
                            <input type="hidden" id="address-uuid" name="address_uuid">
                            
                            <div class="form-group">
                                <label for="address-type">Adresstyp <span class="required">*</span></label>
                                <select id="address-type" name="address_type" required>
                                    <option value="headquarters">Hauptsitz</option>
                                    <option value="delivery">Lieferadresse</option>
                                    <option value="billing">Rechnungsadresse</option>
                                    <option value="other">Sonstiges</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="address-street">Stra√üe</label>
                                <input type="text" id="address-street" name="street" placeholder="Musterstra√üe">
                            </div>
                            
                            <div class="form-group">
                                <label for="address-additional">Adresszusatz</label>
                                <input type="text" id="address-additional" name="address_additional" placeholder="z.B. Geb√§ude A, Etage 3">
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="address-postal-code">PLZ</label>
                                    <input type="text" id="address-postal-code" name="postal_code" placeholder="12345" maxlength="10">
                                </div>
                                <div class="form-group">
                                    <label for="address-city">Stadt <span class="required">*</span></label>
                                    <input type="text" id="address-city" name="city" required placeholder="Musterstadt">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="address-country">Land</label>
                                    <select id="address-country" name="country">
                                        <option value="DE">Deutschland</option>
                                        <option value="AT">√ñsterreich</option>
                                        <option value="CH">Schweiz</option>
                                        <option value="FR">Frankreich</option>
                                        <option value="IT">Italien</option>
                                        <option value="NL">Niederlande</option>
                                        <option value="BE">Belgien</option>
                                        <option value="PL">Polen</option>
                                        <option value="CZ">Tschechien</option>
                                        <option value="UK">Vereinigtes K√∂nigreich</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="address-state">Bundesland / Region</label>
                                    <input type="text" id="address-state" name="state" placeholder="z.B. Bayern">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="address-is-default" name="is_default" value="1">
                                    Als Standardadresse markieren
                                </label>
                            </div>
                            
                            <div class="form-group">
                                <label for="address-notes">Notizen</label>
                                <textarea id="address-notes" name="notes" rows="3" placeholder="Zus√§tzliche Informationen..."></textarea>
                            </div>
                            
                            <div class="form-actions">
                                <button type="submit" class="btn btn-success">Speichern</button>
                                <button type="button" class="btn btn-secondary" onclick="app.closeModal()">Abbrechen</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Add/Edit Channel Modal -->
            <div id="modal-channel" class="modal">
                <div class="modal-content modal-large">
                    <div class="modal-header">
                        <h3 id="modal-channel-title">Kommunikationskanal hinzuf√ºgen</h3>
                        <button class="modal-close">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="form-channel">
                            <input type="hidden" id="channel-uuid" name="channel_uuid">
                            
                            <div class="form-group">
                                <label for="channel-type">Kanaltyp <span class="required">*</span></label>
                                <select id="channel-type" name="channel_type" required>
                                    <option value="email">E-Mail</option>
                                    <option value="phone">Telefon</option>
                                    <option value="mobile">Mobil</option>
                                    <option value="fax">Fax</option>
                                    <option value="website">Website</option>
                                    <option value="other">Sonstiges</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="channel-value">Wert <span class="required">*</span></label>
                                <input type="text" id="channel-value" name="value" required 
                                       placeholder="z.B. info@example.com oder +49 123 456789">
                            </div>
                            
                            <div class="form-group">
                                <label for="channel-label">Bezeichnung</label>
                                <input type="text" id="channel-label" name="label" placeholder="z.B. Hauptnummer, Gesch√§ftsf√ºhrung">
                            </div>
                            
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="channel-is-primary" name="is_primary" value="1">
                                    Als prim√§ren Kanal markieren
                                </label>
                            </div>
                            
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="channel-is-public" name="is_public" value="1">
                                    √ñffentlich sichtbar
                                </label>
                            </div>
                            
                            <div class="form-group">
                                <label for="channel-notes">Notizen</label>
                                <textarea id="channel-notes" name="notes" rows="3" placeholder="Zus√§tzliche Informationen..."></textarea>
                            </div>
                            
                            <div class="form-actions">
                                <button type="submit" class="btn btn-success">Speichern</button>
                                <button type="button" class="btn btn-secondary" onclick="app.closeModal()">Abbrechen</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Add/Edit VAT Registration Modal -->
            <div id="modal-vat" class="modal">
                <div class="modal-content modal-large">
                    <div class="modal-header">
                        <h3 id="modal-vat-title">USt-ID hinzuf√ºgen</h3>
                        <button class="modal-close">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="form-vat">
                            <input type="hidden" id="vat-uuid" name="vat_registration_uuid">
                            
                            <div class="form-group">
                                <label for="vat-country-code">Land <span class="required">*</span></label>
                                <select id="vat-country-code" name="country_code" required>
                                    <option value="DE">Deutschland</option>
                                    <option value="AT">√ñsterreich</option>
                                    <option value="CH">Schweiz</option>
                                    <option value="FR">Frankreich</option>
                                    <option value="IT">Italien</option>
                                    <option value="NL">Niederlande</option>
                                    <option value="BE">Belgien</option>
                                    <option value="PL">Polen</option>
                                    <option value="CZ">Tschechien</option>
                                    <option value="UK">Vereinigtes K√∂nigreich</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="vat-id">USt-ID <span class="required">*</span></label>
                                <input type="text" id="vat-id" name="vat_id" required 
                                       placeholder="z.B. DE123456789 oder ATU12345678">
                                <small class="form-hint">Format je nach Land unterschiedlich</small>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="vat-valid-from">G√ºltig ab</label>
                                    <input type="date" id="vat-valid-from" name="valid_from">
                                </div>
                                <div class="form-group">
                                    <label for="vat-valid-to">G√ºltig bis</label>
                                    <input type="date" id="vat-valid-to" name="valid_to">
                                    <small class="form-hint">Leer lassen f√ºr aktuell g√ºltig</small>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="vat-location-type">Standorttyp</label>
                                <select id="vat-location-type" name="location_type">
                                    <option value="">-- Keine Angabe --</option>
                                    <option value="HQ">Hauptsitz</option>
                                    <option value="Branch">Niederlassung</option>
                                    <option value="Subsidiary">Tochtergesellschaft</option>
                                    <option value="SalesOffice">Verkaufsb√ºro</option>
                                    <option value="Plant">Produktionsst√§tte</option>
                                    <option value="Warehouse">Lager</option>
                                    <option value="Other">Sonstiges</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="vat-is-primary" name="is_primary_for_country" value="1">
                                    Als prim√§re USt-ID f√ºr dieses Land markieren
                                </label>
                            </div>
                            
                            <div class="form-group">
                                <label for="vat-notes">Notizen</label>
                                <textarea id="vat-notes" name="notes" rows="3" placeholder="Zus√§tzliche Informationen..."></textarea>
                            </div>
                            
                            <div class="form-actions">
                                <button type="submit" class="btn btn-success">Speichern</button>
                                <button type="button" class="btn btn-secondary" onclick="app.closeModal()">Abbrechen</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Create Org Modal -->
            <div id="modal-create-org" class="modal">
                <div class="modal-content modal-large">
                    <div class="modal-header">
                        <h3>Neue Organisation anlegen</h3>
                        <button class="modal-close">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="form-create-org">
                            <div class="form-group">
                                <label for="org-create-name">Name <span class="required">*</span></label>
                                <input type="text" id="org-create-name" name="name" required 
                                       placeholder="Firmenname" autocomplete="organization">
                            </div>

                            <div class="form-group">
                                <label for="org-create-external-ref">Kundennummer</label>
                                <input type="text" id="org-create-external-ref" name="external_ref" 
                                       placeholder="Wird automatisch vergeben" readonly>
                                <small class="form-hint">Die n√§chste verf√ºgbare Nummer wird automatisch zugewiesen</small>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="org-create-org-kind">Typ <span class="required">*</span></label>
                                    <select id="org-create-org-kind" name="org_kind" required>
                                        <option value="">-- Bitte w√§hlen --</option>
                                        <option value="customer">Kunde</option>
                                        <option value="supplier">Lieferant</option>
                                        <option value="consultant">Berater</option>
                                        <option value="engineering_firm">Ingenieurb√ºro</option>
                                        <option value="internal">Intern</option>
                                        <option value="other">Sonstiges</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="org-create-status">Status</label>
                                    <select id="org-create-status" name="status">
                                        <option value="lead">Lead</option>
                                        <option value="prospect">Interessent</option>
                                        <option value="customer">Kunde</option>
                                        <option value="inactive">Inaktiv</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="org-create-industry-level1">Branchenbereich (Level 1) <span class="required">*</span></label>
                                    <select id="org-create-industry-level1" name="industry_level1_uuid" required>
                                        <option value="">-- Bitte w√§hlen --</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="org-create-industry-level2">Branche (Level 2) <span class="required">*</span></label>
                                    <select id="org-create-industry-level2" name="industry_level2_uuid" disabled required>
                                        <option value="">-- Zuerst Branchenbereich w√§hlen --</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="org-create-industry-level3">Unterbranche (Level 3) <span class="text-muted">(optional)</span></label>
                                    <select id="org-create-industry-level3" name="industry_level3_uuid" disabled>
                                        <option value="">-- Zuerst Branche w√§hlen --</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="org-create-revenue-range">Umsatzgr√∂√üe</label>
                                    <select id="org-create-revenue-range" name="revenue_range">
                                        <option value="">-- Bitte w√§hlen --</option>
                                        <option value="micro">Micro (< 1 Mio ‚Ç¨)</option>
                                        <option value="small">Small (1-10 Mio ‚Ç¨)</option>
                                        <option value="medium">Medium (10-50 Mio ‚Ç¨)</option>
                                        <option value="large">Large (50-250 Mio ‚Ç¨)</option>
                                        <option value="enterprise">Enterprise (> 250 Mio ‚Ç¨)</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="org-create-employee-count">Mitarbeiter (ca.)</label>
                                    <input type="number" id="org-create-employee-count" name="employee_count" 
                                           min="0" placeholder="z.B. 50">
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="org-create-website">Website</label>
                                <input type="text" id="org-create-website" name="website" 
                                       placeholder="www.example.com oder https://www.example.com">
                                <small class="form-hint">Protokoll (https://) wird automatisch hinzugef√ºgt</small>
                            </div>

                            <div class="form-group">
                                <label for="org-create-notes">Notizen</label>
                                <textarea id="org-create-notes" name="notes" rows="3" 
                                          placeholder="Interne Notizen..."></textarea>
                            </div>

                            <div class="form-actions">
                                <button type="submit" class="btn btn-success" id="btn-submit-create-org">Organisation anlegen</button>
                                <button type="button" class="btn btn-secondary" id="btn-cancel-create-org">Abbrechen</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Projects Page -->
            <div id="page-projects" class="page">
                <div class="page-header">
                    <h2>Projekte</h2>
                    <button class="btn btn-primary" id="btn-create-project">+ Neues Projekt</button>
                </div>
                <div id="projects-list" class="project-list"></div>
            </div>

            <!-- Orgs Page - Search-first Design -->
            <div id="page-orgs" class="page org-search-page">
                <div class="org-search-header">
                    <h1>Organisation finden</h1>
                    <button class="btn btn-primary" id="btn-create-org">+ Neue Organisation</button>
                </div>
                
                <!-- Hauptsuchfeld (Search-first) -->
                <div class="org-main-search">
                    <div class="search-box-large">
                        <span class="search-icon">üîç</span>
                        <input type="text" id="org-search-input" class="org-search-input-large" 
                               placeholder="Firma suchen ‚Ä¶" 
                               autocomplete="off">
                        <div id="org-search-results" class="org-search-results-large"></div>
                    </div>
                    <div class="search-hint">
                        (Name, Branche, Ort, Umsatz, K√ºrzel)
                    </div>
                    
                    <!-- Filter einblenden Button -->
                    <button class="btn-filter-toggle" id="btn-toggle-filters">
                        <span class="filter-icon">‚öôÔ∏è</span>
                        <span class="filter-text">Filter einblenden</span>
                        <span class="filter-arrow">‚ñæ</span>
                    </button>
                </div>
                
                <!-- Ausklappbare Filter -->
                <div id="org-filters-panel" class="org-filters-panel" style="display: none;">
                    <div class="filters-grid">
                        <div class="filter-group">
                            <label>Branche</label>
                            <select id="filter-industry-main" class="filter-select">
                                <option value="">-- Hauptklasse w√§hlen --</option>
                            </select>
                            <select id="filter-industry-sub" class="filter-select" style="margin-top: 0.5rem;" disabled>
                                <option value="">-- Unterklasse w√§hlen --</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label>Ort / Region</label>
                            <input type="text" id="filter-city" class="filter-input-small" placeholder="PLZ / Stadt">
                            <input type="number" id="filter-radius" class="filter-input-small" placeholder="‚åÄ km" min="0" max="1000">
                        </div>
                        
                        <div class="filter-group">
                            <label>Umsatz (letztes Jahr)</label>
                            <div class="filter-range">
                                <input type="number" id="filter-revenue-min" class="filter-input-small" placeholder="Min (Mio ‚Ç¨)" min="0">
                                <span>‚Äì</span>
                                <input type="number" id="filter-revenue-max" class="filter-input-small" placeholder="Max (Mio ‚Ç¨)" min="0">
                            </div>
                        </div>
                        
                        <div class="filter-group">
                            <label>Mitarbeiter</label>
                            <div id="filter-employees" class="filter-checkboxes">
                                <label><input type="checkbox" value="0-10"> <10</label>
                                <label><input type="checkbox" value="10-50"> 10‚Äì50</label>
                                <label><input type="checkbox" value="50-250"> 50‚Äì250</label>
                                <label><input type="checkbox" value="250+"> >250</label>
                            </div>
                        </div>
                        
                        <div class="filter-group">
                            <label>Status</label>
                            <div id="filter-status" class="filter-checkboxes">
                                <label><input type="checkbox" value="lead"> Lead</label>
                                <label><input type="checkbox" value="prospect"> Interessent</label>
                                <label><input type="checkbox" value="customer"> Kunde</label>
                                <label><input type="checkbox" value="inactive"> Inaktiv</label>
                            </div>
                        </div>
                        
                        <div class="filter-group">
                            <label>Kundenklasse</label>
                            <div id="filter-tiers" class="filter-checkboxes">
                                <label><input type="checkbox" value="A"> A-Kunde</label>
                                <label><input type="checkbox" value="B"> B-Kunde</label>
                                <label><input type="checkbox" value="C"> C-Kunde</label>
                                <label><input type="checkbox" value="S"> Strategisch (S)</label>
                            </div>
                        </div>
                        
                        <div class="filter-group">
                            <label>Typ</label>
                            <div id="filter-org-kind" class="filter-checkboxes">
                                <label><input type="checkbox" value="customer"> Kunde</label>
                                <label><input type="checkbox" value="supplier"> Lieferant</label>
                                <label><input type="checkbox" value="consultant"> Berater</label>
                                <label><input type="checkbox" value="engineering_firm"> Ingenieurb√ºro</label>
                            </div>
                        </div>
                        
                        <div class="filter-group">
                            <label>
                                <input type="checkbox" id="filter-include-archived" data-filter="include_archived">
                                Auch archivierte Organisationen anzeigen
                            </label>
                        </div>
                    </div>
                    <div class="filters-actions">
                        <button class="btn btn-primary" id="btn-apply-filters">Filter anwenden</button>
                        <button class="btn btn-secondary" id="btn-reset-filters">Filter zur√ºcksetzen</button>
                    </div>
                </div>
                
                <!-- Zuletzt verwendet Sektion -->
                <div id="org-recent-section" class="org-recent-section">
                    <h3>Zuletzt verwendet</h3>
                    <div id="org-recent-list" class="org-recent-list"></div>
                </div>
                
                <!-- Ergebnisliste -->
                <div id="orgs-list" class="org-list-results"></div>
                
                <!-- Leerer Zustand / "Meintest du...?" -->
                <div id="org-empty-state" class="org-empty-state" style="display: none;">
                    <div class="empty-icon">‚ùå</div>
                    <h3>Keine Organisation gefunden</h3>
                    <div id="org-suggestions" class="org-suggestions"></div>
                    <button class="btn btn-secondary" id="btn-adjust-filters">Filter anpassen</button>
                </div>
            </div>

            <!-- Persons Page - Search-first Design -->
            <div id="page-persons" class="page person-search-page">
                <div class="person-search-header">
                    <h1>Person finden</h1>
                    <button class="btn btn-primary" id="btn-create-person">+ Neue Person</button>
                </div>
                
                <!-- Hauptsuchfeld (Search-first) -->
                <div class="person-main-search">
                    <div class="search-box-large">
                        <span class="search-icon">üîç</span>
                        <input type="text" id="person-search-input" class="person-search-input-large" 
                               placeholder="Person suchen ‚Ä¶" 
                               autocomplete="off">
                        <div id="person-search-results" class="person-search-results-large"></div>
                    </div>
                    <div class="search-hint">
                        (Name, E-Mail, Firma)
                    </div>
                </div>
                
                <!-- Zuletzt verwendet Sektion -->
                <div id="person-recent-section" class="person-recent-section">
                    <h3>Zuletzt angesehen</h3>
                    <div id="person-recent-list" class="person-recent-list"></div>
                </div>
            </div>

            <!-- Accounts Page (Account Dashboard) -->
            <div id="page-accounts" class="page">
                <div class="page-header">
                    <h2>Meine Kunden</h2>
                    <div class="account-header-actions">
                        <select id="account-filter-health" class="filter-select">
                            <option value="">Alle</option>
                            <option value="red">üî¥ Aufmerksamkeit n√∂tig</option>
                            <option value="yellow">üü° Risiken</option>
                            <option value="green">üü¢ Alles OK</option>
                        </select>
                    </div>
                </div>
                
                <!-- Aufmerksamkeit n√∂tig Block -->
                <div id="account-attention-section" class="account-attention-section" style="display: none;">
                    <h3>‚ö†Ô∏è Aufmerksamkeit n√∂tig</h3>
                    <div id="account-attention-list" class="account-list"></div>
                </div>
                
                <!-- Alle Accounts -->
                <div id="accounts-list" class="account-list"></div>
                
                <!-- Empty State -->
                <div id="accounts-empty-state" class="empty-state" style="display: none;">
                    <div class="empty-state-icon">üë§</div>
                    <p>Keine Kunden zugeordnet</p>
                </div>
            </div>

            <!-- Admin-Bereich -->
            <div id="page-admin" class="page">
                <div class="page-header">
                    <h2>Admin - User & Rollenverwaltung</h2>
                </div>
                
                <div class="admin-section">
                    <div class="admin-tabs">
                        <button class="admin-tab active" data-tab="users">User</button>
                        <button class="admin-tab" data-tab="roles">Rollen</button>
                    </div>
                    
                    <!-- User-Verwaltung -->
                    <div id="admin-tab-users" class="admin-tab-content active">
                        <div class="admin-actions">
                            <button class="btn btn-primary" id="btn-create-user">Neuer User</button>
                            <button class="btn btn-secondary" id="btn-show-inactive">Inaktive User anzeigen</button>
                        </div>
                        <div id="admin-users-list" class="admin-list"></div>
                    </div>
                    
                    <!-- Rollen-Verwaltung -->
                    <div id="admin-tab-roles" class="admin-tab-content">
                        <div id="admin-roles-list" class="admin-list"></div>
                    </div>
                </div>
            </div>

            <!-- Dokumente Suche -->
            <div id="page-documents" class="page document-search-page">
                <div class="document-search-header">
                    <h1>Dokumente</h1>
                </div>
                
                <!-- Suchfeld und Filter -->
                <div class="document-search-container">
                    <div class="document-search-box">
                        <div class="search-box-large">
                            <span class="search-icon">üîç</span>
                            <input type="text" id="document-search-input" class="document-search-input-large" 
                                   placeholder="Dokumente suchen (Titel, Inhalt, Tags, Rollen) ‚Ä¶" 
                                   autocomplete="off">
                        </div>
                    </div>
                    
                    <!-- Filter-Bereich -->
                    <div class="document-filters">
                        <div class="filter-row">
                            <div class="filter-group">
                                <label for="filter-classification">Klassifikation</label>
                                <select id="filter-classification" class="filter-select">
                                    <option value="">Alle</option>
                                    <option value="invoice">Rechnung</option>
                                    <option value="quote">Angebot</option>
                                    <option value="contract">Vertrag</option>
                                    <option value="email_attachment">E-Mail-Anhang</option>
                                    <option value="other">Sonstiges</option>
                                </select>
                            </div>
                            
                            <div class="filter-group">
                                <label for="filter-source">Quelle</label>
                                <select id="filter-source" class="filter-select">
                                    <option value="">Alle</option>
                                    <option value="upload">Upload</option>
                                    <option value="email">E-Mail</option>
                                    <option value="api">API</option>
                                    <option value="import">Import</option>
                                </select>
                            </div>
                            
                            <div class="filter-group">
                                <label for="filter-status">Status</label>
                                <select id="filter-status" class="filter-select">
                                    <option value="">Alle</option>
                                    <option value="active">Aktiv</option>
                                    <option value="blocked">Blockiert</option>
                                    <option value="deleted">Gel√∂scht</option>
                                </select>
                            </div>
                            
                            <div class="filter-group">
                                <label for="filter-date-from">Von</label>
                                <input type="date" id="filter-date-from" class="filter-input">
                            </div>
                            
                            <div class="filter-group">
                                <label for="filter-date-to">Bis</label>
                                <input type="date" id="filter-date-to" class="filter-input">
                            </div>
                            
                            <div class="filter-group">
                                <label>
                                    <input type="checkbox" id="filter-orphaned-only">
                                    Nur ohne Zuordnung
                                </label>
                            </div>
                            
                            <div class="filter-group">
                                <button id="btn-reset-filters" class="btn btn-secondary btn-sm">Filter zur√ºcksetzen</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Zuletzt verwendet Sektion -->
                <div id="document-recent-section" class="document-recent-section">
                    <h3>Zuletzt verwendet</h3>
                    <div id="document-recent-list" class="document-recent-list"></div>
                </div>
                
                <!-- Suchergebnisse -->
                <div id="document-search-results" class="document-search-results">
                    <div class="search-placeholder">
                        <p>Geben Sie einen Suchbegriff ein oder verwenden Sie die Filter, um Dokumente zu finden.</p>
                    </div>
                </div>
            </div>

            <!-- Monitoring Dashboard -->
            <div id="page-monitoring" class="page">
                <div class="page-header">
                    <h2>Monitoring Dashboard</h2>
                    <div class="header-actions">
                        <button class="btn btn-secondary" id="monitoring-btn-refresh">Aktualisieren</button>
                        <label class="auto-refresh-toggle">
                            <input type="checkbox" id="monitoring-auto-refresh" checked>
                            <span>Auto-Refresh (30s)</span>
                        </label>
                    </div>
                </div>
                
                <div id="monitoring-content" class="monitoring-content">
                    <!-- System Status -->
                    <section class="status-section">
                        <h3>System Status</h3>
                        <div class="status-grid">
                            <div class="status-card" id="status-database">
                                <div class="status-indicator" data-status="unknown"></div>
                                <div class="status-content">
                                    <div class="status-label">MySQL</div>
                                    <div class="status-value" id="db-status">Pr√ºfe...</div>
                                </div>
                            </div>
                            <div class="status-card" id="status-neo4j">
                                <div class="status-indicator" data-status="unknown"></div>
                                <div class="status-content">
                                    <div class="status-label">Neo4j</div>
                                    <div class="status-value" id="neo4j-status">Pr√ºfe...</div>
                                </div>
                            </div>
                            <div class="status-card" id="status-sync">
                                <div class="status-indicator" data-status="unknown"></div>
                                <div class="status-content">
                                    <div class="status-label">Sync-Worker</div>
                                    <div class="status-value" id="sync-status">Pr√ºfe...</div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Scheduled Tasks Details -->
                    <section class="metrics-section" id="scheduled-tasks-section">
                        <h3>üìÖ Windows Scheduled Tasks</h3>
                        <div id="scheduled-tasks-list" class="scheduled-tasks-list"></div>
                    </section>

                    <!-- Outbox Metrics -->
                    <section class="metrics-section">
                        <h3>Outbox Events</h3>
                        <div id="outbox-metrics" class="metrics-grid"></div>
                        <div class="chart-container">
                            <canvas id="chart-outbox"></canvas>
                        </div>
                    </section>

                    <!-- Case Statistics -->
                    <section class="metrics-section">
                        <h3>Vorgangs-Statistiken</h3>
                        <div id="case-statistics" class="metrics-grid"></div>
                        <div class="chart-container">
                            <canvas id="chart-cases"></canvas>
                        </div>
                    </section>

                    <!-- ClamAV Security Status -->
                    <section class="metrics-section" id="clamav-section">
                        <h3>üîí ClamAV Security Status</h3>
                        <div class="metrics-grid" id="clamav-metrics">
                            <div class="metric-card">
                                <div class="metric-icon">üõ°Ô∏è</div>
                                <div class="metric-content">
                                    <div class="metric-value" id="clamav-version">-</div>
                                    <div class="metric-label">Version</div>
                                </div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-icon">üîÑ</div>
                                <div class="metric-content">
                                    <div class="metric-value" id="clamav-update-age">-</div>
                                    <div class="metric-label">Definitionen-Alter</div>
                                </div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-icon">‚è≥</div>
                                <div class="metric-content">
                                    <div class="metric-value" id="clamav-pending">-</div>
                                    <div class="metric-label">Ausstehende Scans</div>
                                </div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-icon">‚öôÔ∏è</div>
                                <div class="metric-content">
                                    <div class="metric-value" id="clamav-worker-status">-</div>
                                    <div class="metric-label">Worker-Status</div>
                                </div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-icon">‚úÖ</div>
                                <div class="metric-content">
                                    <div class="metric-value" id="clamav-clean">-</div>
                                    <div class="metric-label">Saubere Dateien</div>
                                </div>
                            </div>
                            <div class="metric-card" id="clamav-infected-card" style="display: none;">
                                <div class="metric-icon">‚ö†Ô∏è</div>
                                <div class="metric-content">
                                    <div class="metric-value" id="clamav-infected" style="color: #ef4444; font-weight: bold;">-</div>
                                    <div class="metric-label">‚ö†Ô∏è Infizierte Dateien</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Infizierte Dateien Liste -->
                        <div id="clamav-infected-list" class="infected-list" style="display: none;">
                            <h3 style="color: #ef4444; margin-top: 1.5rem; margin-bottom: 1rem;">‚ö†Ô∏è Infizierte Dateien</h3>
                            <div id="infected-files-list" class="infected-files-list">
                                <div class="loading">Lade infizierte Dateien...</div>
                            </div>
                        </div>
                    </section>

                    <!-- Sync Statistics -->
                    <section class="metrics-section">
                        <h3>Neo4j Sync-Statistiken</h3>
                        <div id="sync-statistics" class="metrics-grid"></div>
                    </section>

                    <!-- Recent Errors -->
                    <section class="metrics-section">
                        <h3>Letzte Fehler</h3>
                        <div id="recent-errors-list" class="errors-list"></div>
                    </section>

                    <!-- Event Types Distribution -->
                    <section class="metrics-section">
                        <h3>Event-Typen-Verteilung (24h)</h3>
                        <div class="chart-container">
                            <canvas id="chart-events"></canvas>
                        </div>
                    </section>

                    <!-- Activity Log -->
                    <section class="metrics-section">
                        <h3>Activity Log</h3>
                        <div id="activity-log-list" class="activity-log-list"></div>
                    </section>

                    <!-- Duplicate Check Results -->
                    <section class="metrics-section" id="duplicates-section">
                        <h3>Duplikaten-Pr√ºfung</h3>
                        <div id="duplicates-list" class="duplicates-list"></div>
                    </section>
                </div>
            </div>

            <!-- Import Page -->
            <div id="page-import" class="page">
                <!-- Wird dynamisch von ImportModule gerendert -->
            </div>
        </main>
    </div>
    
    <!-- Toast Notifications - Muss vor den Scripts sein -->
    <div id="toast-container" class="toast-container"></div>

    <script src="js/modules/csrf-token.js"></script>
    <script src="js/api.js"></script>
    <script src="js/monitoring.js"></script>
    <script type="module" src="js/app.js"></script>
</body>
</html>

